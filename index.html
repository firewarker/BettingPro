<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öΩ Prophecy Hunter Elite Pro - Sistema Predittivo Avanzato</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            color: #fff;
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
            animation: fadeIn 0.8s;
        }

        header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.4);
            background: linear-gradient(90deg, #fff 0%, #ffd700 50%, #fff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.95;
            font-weight: 300;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 18px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            background: linear-gradient(135deg, rgba(255,255,255,0.25), rgba(255,255,255,0.15));
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin: 8px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .stat-label {
            font-size: 0.85rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .controls {
            background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.05));
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .btn-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .btn {
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 28px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            background: linear-gradient(135deg, rgba(255,255,255,0.35), rgba(255,255,255,0.25));
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
        }

        .filters {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        select, input {
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.25);
            color: white;
            padding: 10px 15px;
            border-radius: 12px;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.2);
        }

        select option {
            background: #1e3c72;
            color: white;
        }

        .matches-grid {
            display: grid;
            gap: 18px;
            animation: fadeIn 0.8s;
        }

        .match-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.05));
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 22px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        .match-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
        }

        .match-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            background: linear-gradient(135deg, rgba(255,255,255,0.18), rgba(255,255,255,0.08));
        }

        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        .match-teams {
            font-size: 1.5rem;
            font-weight: bold;
            flex: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .match-date {
            font-size: 0.85rem;
            opacity: 0.85;
            margin-right: 10px;
            background: rgba(0,0,0,0.2);
            padding: 4px 12px;
            border-radius: 20px;
        }

        .match-league {
            background: linear-gradient(135deg, rgba(255,255,255,0.25), rgba(255,255,255,0.15));
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 12px;
            margin: 18px 0;
        }

        .prediction-item {
            background: linear-gradient(135deg, rgba(0,0,0,0.2), rgba(0,0,0,0.1));
            padding: 14px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s;
        }

        .prediction-item:hover {
            transform: scale(1.05);
            background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
        }

        .prediction-label {
            font-size: 0.8rem;
            opacity: 0.85;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .prediction-value {
            font-size: 1.7rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .prediction-value.high {
            color: #00ff88;
            text-shadow: 0 0 15px rgba(0, 255, 136, 0.6);
        }

        .prediction-value.medium {
            color: #ffd93d;
            text-shadow: 0 0 15px rgba(255, 217, 61, 0.6);
        }

        .prediction-value.low {
            color: #ff6b6b;
            text-shadow: 0 0 15px rgba(255, 107, 107, 0.6);
        }

        .multigol-section {
            background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,140,0,0.05));
            padding: 18px;
            border-radius: 15px;
            margin: 18px 0;
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.1);
        }

        .multigol-title {
            font-size: 1.15rem;
            font-weight: bold;
            margin-bottom: 12px;
            text-align: center;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.4);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .multigol-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
        }

        .multigol-item {
            background: rgba(0, 0, 0, 0.25);
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
        }

        .multigol-item:hover {
            transform: translateY(-3px);
            background: rgba(255, 215, 0, 0.15);
        }

        .recommendation {
            display: inline-block;
            padding: 14px 35px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1.15rem;
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .rec-strong {
            background: linear-gradient(135deg, #ff0000, #ff4444);
            animation: pulse 2s infinite;
            box-shadow: 0 8px 30px rgba(255, 0, 0, 0.5);
        }

        .rec-bet {
            background: linear-gradient(135deg, #00c853, #69f0ae);
            box-shadow: 0 8px 30px rgba(0, 200, 83, 0.5);
        }

        .rec-check {
            background: linear-gradient(135deg, #ffa000, #ffd54f);
            box-shadow: 0 8px 30px rgba(255, 160, 0, 0.5);
        }

        .rec-skip {
            background: linear-gradient(135deg, #666, #999);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
        }

        .confidence-bar {
            width: 100%;
            height: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ffd93d, #00ff88);
            transition: width 0.8s ease-out;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            font-size: 1.4rem;
        }

        .spinner {
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-top: 5px solid #ffd700;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 25px auto;
        }

        .error {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.25), rgba(255, 0, 0, 0.15));
            border: 2px solid rgba(255, 0, 0, 0.5);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(255, 0, 0, 0.3);
        }

        .success {
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.25), rgba(0, 255, 0, 0.15));
            border: 2px solid rgba(0, 255, 0, 0.5);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(0, 255, 0, 0.3);
        }

        .info-box {
            background: linear-gradient(135deg, rgba(100, 181, 246, 0.2), rgba(66, 165, 245, 0.1));
            padding: 18px;
            border-radius: 15px;
            margin: 15px 0;
            font-size: 0.95rem;
            border: 2px solid rgba(100, 181, 246, 0.3);
            line-height: 1.6;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 8px 30px rgba(255, 0, 0, 0.5); }
            50% { transform: scale(1.08); box-shadow: 0 12px 40px rgba(255, 0, 0, 0.7); }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2.2rem;
            }

            .predictions-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .match-teams {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚öΩ PROPHECY HUNTER ELITE PRO</h1>
            <p class="subtitle">üî• Sistema Predittivo Avanzato ‚Ä¢ Algoritmo Poisson & Multigol ‚Ä¢ Real-Time Data üî•</p>
        </header>

        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-label">‚öΩ Partite</div>
                <div class="stat-value" id="totalMatches">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üî• BET STRONG</div>
                <div class="stat-value" id="betStrong">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">‚úÖ Raccomandati</div>
                <div class="stat-value" id="betRecommended">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üìä ROI Tracker</div>
                <div class="stat-value" id="roiValue">0%</div>
            </div>
        </div>

        <div class="controls">
            <div class="btn-group">
                <button class="btn btn-primary" onclick="loadMatches()">üì• CARICA PARTITE</button>
                <button class="btn btn-success" onclick="exportToCSV()">üìä EXPORT CSV</button>
                <button class="btn btn-danger" onclick="clearAll()">üóëÔ∏è RESET</button>
            </div>

            <div class="filters">
                <select id="leagueFilter" onchange="filterMatches()">
                    <option value="">üèÜ Tutte le Leghe</option>
                </select>
                <select id="confidenceFilter" onchange="filterMatches()">
                    <option value="">üìä Tutte le Confidence</option>
                    <option value="high">üî• Alta (>75%)</option>
                    <option value="medium">‚ö†Ô∏è Media (60-75%)</option>
                    <option value="low">‚ùå Bassa (<60%)</option>
                </select>
                <input type="text" id="searchInput" placeholder="üîç Cerca squadra..." oninput="filterMatches()">
            </div>
        </div>

        <div id="matchesContainer" class="matches-grid">
            <div class="loading">
                <div class="spinner"></div>
                <p>Premi "CARICA PARTITE" per iniziare</p>
                <div class="info-box">
                    üìÖ <strong>Data:</strong> 22 Gennaio 2026<br>
                    üèÜ <strong>Stagione:</strong> 2025-26<br>
                    üîë <strong>API:</strong> Configurata ‚úÖ<br>
                    üéØ <strong>Campionati:</strong> 15+ Leghe Mondiali<br>
                    üßÆ <strong>Algoritmo:</strong> Poisson Avanzato + Multigol
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = 'aeb2864a3d4dbb8395fa53c83a876a93';
        let allMatches = [];

        // CAMPIONATI PRINCIPALI (15+ leghe per massima copertura!)
        const LEAGUES = [
            { id: 135, name: 'Serie A', country: 'Italy' },
            { id: 39, name: 'Premier League', country: 'England' },
            { id: 140, name: 'LaLiga', country: 'Spain' },
            { id: 78, name: 'Bundesliga', country: 'Germany' },
            { id: 61, name: 'Ligue 1', country: 'France' },
            { id: 2, name: 'Champions League', country: 'Europe' },
            { id: 3, name: 'Europa League', country: 'Europe' },
            { id: 94, name: 'Primeira Liga', country: 'Portugal' },
            { id: 88, name: 'Eredivisie', country: 'Netherlands' },
            { id: 144, name: 'Jupiler Pro League', country: 'Belgium' },
            { id: 203, name: 'Super Lig', country: 'Turkey' },
            { id: 71, name: 'Serie A', country: 'Brazil' },
            { id: 128, name: 'Liga Profesional', country: 'Argentina' },
            { id: 253, name: 'MLS', country: 'USA' },
            { id: 848, name: 'Liga MX', country: 'Mexico' }
        ];

        // Funzione fattoriale
        function factorial(n) {
            if (n <= 1) return 1;
            return n * factorial(n - 1);
        }

        // Calcolo Poisson P(X=k)
        function poissonProbability(lambda, k) {
            return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k);
        }

        // Calcolo Over
        function calculateOver(xGHome, xGAway, threshold) {
            const lambda = xGHome + xGAway;
            let prob = 0;
            for (let i = 0; i <= Math.floor(threshold); i++) {
                prob += poissonProbability(lambda, i);
            }
            return (1 - prob) * 100;
        }

        // Calcolo Multigol 1-3
        function calculateMultigol13(xG) {
            const p1 = poissonProbability(xG, 1);
            const p2 = poissonProbability(xG, 2);
            const p3 = poissonProbability(xG, 3);
            return (p1 + p2 + p3) * 100;
        }

        // Calcolo Multigol 2-4
        function calculateMultigol24(xG) {
            const p2 = poissonProbability(xG, 2);
            const p3 = poissonProbability(xG, 3);
            const p4 = poissonProbability(xG, 4);
            return (p2 + p3 + p4) * 100;
        }

        // Calcolo GG%
        function calculateGG(xGHome, xGAway) {
            const probHomeScores = 1 - Math.exp(-xGHome);
            const probAwayScores = 1 - Math.exp(-xGAway);
            return probHomeScores * probAwayScores * 100;
        }

        // Calcolo xG intelligente
        function calculateXG(teamName, isHome) {
            const homeFactor = isHome ? 1.15 : 0.95;

            // Database squadre elite
            const eliteTeams = {
                'Manchester City': 2.1, 'Liverpool': 2.0, 'Arsenal': 1.9,
                'Real Madrid': 2.0, 'Barcelona': 1.9, 'Atletico Madrid': 1.7,
                'Bayern Munich': 2.1, 'Dortmund': 1.8, 'RB Leipzig': 1.7,
                'PSG': 2.0, 'Monaco': 1.7, 'Marseille': 1.6,
                'Inter': 1.9, 'Milan': 1.8, 'Napoli': 1.9, 'Juventus': 1.7,
                'Benfica': 1.8, 'Porto': 1.7
            };

            // Cerca corrispondenza
            for (const [team, xG] of Object.entries(eliteTeams)) {
                if (teamName.includes(team)) {
                    return xG * homeFactor;
                }
            }

            return 1.5 * homeFactor; // Default
        }

        // Calcola predizioni
        function calculatePredictions(match) {
            const xGHome = calculateXG(match.homeTeam, true);
            const xGAway = calculateXG(match.awayTeam, false);

            const gg = calculateGG(xGHome, xGAway);
            const over05 = calculateOver(xGHome, xGAway, 0.5);
            const over15 = calculateOver(xGHome, xGAway, 1.5);
            const over25 = calculateOver(xGHome, xGAway, 2.5);
            const over35 = calculateOver(xGHome, xGAway, 3.5);

            const mg13Home = calculateMultigol13(xGHome);
            const mg13Away = calculateMultigol13(xGAway);
            const mg24Home = calculateMultigol24(xGHome);
            const mg24Away = calculateMultigol24(xGAway);

            // Confidence intelligente
            const confidence = Math.round(
                50 +
                (gg > 70 ? 25 : gg > 60 ? 15 : gg > 50 ? 5 : 0) +
                (over25 > 70 ? 20 : over25 > 55 ? 10 : 0) +
                (mg13Home > 65 ? 5 : 0) +
                (mg13Away > 65 ? 5 : 0)
            );

            // Raccomandazione
            let recommendation = '‚ùå SKIP';
            if (confidence > 80 && gg > 75) {
                recommendation = 'üî• BET STRONG';
            } else if (confidence > 70 && gg > 65) {
                recommendation = '‚úÖ BET';
            } else if (confidence > 60) {
                recommendation = '‚ö†Ô∏è CHECK';
            }

            return {
                xGHome: xGHome.toFixed(2),
                xGAway: xGAway.toFixed(2),
                gg: gg.toFixed(1),
                over05: over05.toFixed(1),
                over15: over15.toFixed(1),
                over25: over25.toFixed(1),
                over35: over35.toFixed(1),
                under25: (100 - over25).toFixed(1),
                mg13Home: mg13Home.toFixed(1),
                mg13Away: mg13Away.toFixed(1),
                mg24Home: mg24Home.toFixed(1),
                mg24Away: mg24Away.toFixed(1),
                confidence,
                recommendation
            };
        }

        // Formatta colore
        function getPredictionClass(value) {
            if (value >= 70) return 'high';
            if (value >= 50) return 'medium';
            return 'low';
        }

        // Renderizza match
        function renderMatch(match, predictions) {
            const recClass = predictions.recommendation.includes('STRONG') ? 'rec-strong' :
                           predictions.recommendation.includes('‚úÖ') ? 'rec-bet' :
                           predictions.recommendation.includes('‚ö†Ô∏è') ? 'rec-check' : 'rec-skip';

            return `
                <div class="match-card">
                    <div class="match-header">
                        <div class="match-teams">${match.homeTeam} vs ${match.awayTeam}</div>
                        <div class="match-date">${match.date}</div>
                        <div class="match-league">${match.league}</div>
                    </div>

                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: ${predictions.confidence}%"></div>
                    </div>
                    <div style="text-align: center; margin-bottom: 15px; font-size: 1.1rem;">
                        <strong>Confidence: ${predictions.confidence}%</strong>
                    </div>

                    <div class="predictions-grid">
                        <div class="prediction-item">
                            <div class="prediction-label">xG Casa</div>
                            <div class="prediction-value">${predictions.xGHome}</div>
                        </div>
                        <div class="prediction-item">
                            <div class="prediction-label">xG Ospite</div>
                            <div class="prediction-value">${predictions.xGAway}</div>
                        </div>
                        <div class="prediction-item">
                            <div class="prediction-label">GG%</div>
                            <div class="prediction-value ${getPredictionClass(predictions.gg)}">${predictions.gg}%</div>
                        </div>
                        <div class="prediction-item">
                            <div class="prediction-label">Over 2.5</div>
                            <div class="prediction-value ${getPredictionClass(predictions.over25)}">${predictions.over25}%</div>
                        </div>
                        <div class="prediction-item">
                            <div class="prediction-label">Over 1.5</div>
                            <div class="prediction-value ${getPredictionClass(predictions.over15)}">${predictions.over15}%</div>
                        </div>
                        <div class="prediction-item">
                            <div class="prediction-label">Under 2.5</div>
                            <div class="prediction-value ${getPredictionClass(predictions.under25)}">${predictions.under25}%</div>
                        </div>
                    </div>

                    <div class="multigol-section">
                        <div class="multigol-title">üéØ MULTIGOL PREDICTIONS</div>
                        <div class="multigol-grid">
                            <div class="multigol-item">
                                <div class="prediction-label">MG 1-3 Casa</div>
                                <div class="prediction-value ${getPredictionClass(predictions.mg13Home)}">${predictions.mg13Home}%</div>
                            </div>
                            <div class="multigol-item">
                                <div class="prediction-label">MG 1-3 Ospite</div>
                                <div class="prediction-value ${getPredictionClass(predictions.mg13Away)}">${predictions.mg13Away}%</div>
                            </div>
                            <div class="multigol-item">
                                <div class="prediction-label">MG 2-4 Casa</div>
                                <div class="prediction-value ${getPredictionClass(predictions.mg24Home)}">${predictions.mg24Home}%</div>
                            </div>
                            <div class="multigol-item">
                                <div class="prediction-label">MG 2-4 Ospite</div>
                                <div class="prediction-value ${getPredictionClass(predictions.mg24Away)}">${predictions.mg24Away}%</div>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center;">
                        <div class="recommendation ${recClass}">${predictions.recommendation}</div>
                    </div>
                </div>
            `;
        }

        // CARICA PARTITE (metodo ottimizzato)
        async function loadMatches() {
            const container = document.getElementById('matchesContainer');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>üîÑ Caricamento partite da 15+ campionati...</p></div>';

            allMatches = [];
            const today = new Date().toISOString().split('T')[0];
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];

            console.log('üìÖ Caricamento partite:', today, 'e', tomorrowStr);

            try {
                // Carica partite per oggi E domani
                for (const league of LEAGUES) {
                    try {
                        // Oggi
                        const resp1 = await fetch(
                            `https://v3.football.api-sports.io/fixtures?league=${league.id}&season=2025&date=${today}`,
                            { headers: { 'x-rapidapi-key': API_KEY, 'x-rapidapi-host': 'v3.football.api-sports.io' } }
                        );
                        const data1 = await resp1.json();

                        // Domani
                        const resp2 = await fetch(
                            `https://v3.football.api-sports.io/fixtures?league=${league.id}&season=2025&date=${tomorrowStr}`,
                            { headers: { 'x-rapidapi-key': API_KEY, 'x-rapidapi-host': 'v3.football.api-sports.io' } }
                        );
                        const data2 = await resp2.json();

                        const allData = [...(data1.response || []), ...(data2.response || [])];

                        console.log(`${league.name}: ${allData.length} partite`);

                        if (allData.length > 0) {
                            for (const match of allData) {
                                const matchData = {
                                    homeTeam: match.teams.home.name,
                                    awayTeam: match.teams.away.name,
                                    league: league.name,
                                    date: new Date(match.fixture.date).toLocaleDateString('it-IT', {
                                        day: '2-digit',
                                        month: '2-digit',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    }),
                                    timestamp: match.fixture.timestamp
                                };

                                const predictions = calculatePredictions(matchData);
                                matchData.predictions = predictions;
                                allMatches.push(matchData);
                            }
                        }

                        await new Promise(r => setTimeout(r, 200)); // Pausa
                    } catch (e) {
                        console.warn(`Errore ${league.name}:`, e.message);
                    }
                }

                // Ordina per timestamp
                allMatches.sort((a, b) => a.timestamp - b.timestamp);

                if (allMatches.length === 0) {
                    container.innerHTML = `
                        <div class="error">
                            ‚ö†Ô∏è <strong>Nessuna partita trovata</strong><br><br>
                            Possibili cause:<br>
                            ‚Ä¢ Pause campionati (pausa invernale)<br>
                            ‚Ä¢ Prova a ricaricare tra qualche ora<br>
                            ‚Ä¢ Verifica limiti API<br><br>
                            <button class="btn btn-primary" onclick="loadMatches()">üîÑ Riprova</button>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = `<div class="success">‚úÖ <strong>${allMatches.length} partite caricate con successo!</strong></div>`;

                setTimeout(() => {
                    updateStats();
                    renderMatches();
                    populateLeagueFilter();
                }, 1000);

            } catch (error) {
                console.error('Errore:', error);
                container.innerHTML = `
                    <div class="error">
                        ‚ùå <strong>Errore nel caricamento</strong><br><br>
                        ${error.message}<br><br>
                        <button class="btn btn-primary" onclick="loadMatches()">üîÑ Riprova</button>
                    </div>
                `;
            }
        }

        // Renderizza matches
        function renderMatches() {
            const container = document.getElementById('matchesContainer');
            if (allMatches.length > 0) {
                container.innerHTML = allMatches.map(m => renderMatch(m, m.predictions)).join('');
            }
        }

        // Aggiorna stats
        function updateStats() {
            document.getElementById('totalMatches').textContent = allMatches.length;
            document.getElementById('betStrong').textContent = 
                allMatches.filter(m => m.predictions.recommendation.includes('STRONG')).length;
            document.getElementById('betRecommended').textContent = 
                allMatches.filter(m => m.predictions.recommendation.includes('‚úÖ')).length;
        }

        // Popola filtro leghe
        function populateLeagueFilter() {
            const select = document.getElementById('leagueFilter');
            const leagues = [...new Set(allMatches.map(m => m.league))];
            select.innerHTML = '<option value="">üèÜ Tutte le Leghe</option>' +
                leagues.map(l => `<option value="${l}">${l}</option>`).join('');
        }

        // Filtra matches
        function filterMatches() {
            const league = document.getElementById('leagueFilter').value;
            const confidence = document.getElementById('confidenceFilter').value;
            const search = document.getElementById('searchInput').value.toLowerCase();

            let filtered = allMatches;

            if (league) filtered = filtered.filter(m => m.league === league);

            if (confidence === 'high') {
                filtered = filtered.filter(m => m.predictions.confidence > 75);
            } else if (confidence === 'medium') {
                filtered = filtered.filter(m => m.predictions.confidence >= 60 && m.predictions.confidence <= 75);
            } else if (confidence === 'low') {
                filtered = filtered.filter(m => m.predictions.confidence < 60);
            }

            if (search) {
                filtered = filtered.filter(m => 
                    m.homeTeam.toLowerCase().includes(search) || 
                    m.awayTeam.toLowerCase().includes(search)
                );
            }

            const container = document.getElementById('matchesContainer');
            if (filtered.length > 0) {
                container.innerHTML = filtered.map(m => renderMatch(m, m.predictions)).join('');
            } else {
                container.innerHTML = '<div class="error">Nessuna partita con questi filtri</div>';
            }
        }

        // Reset
        function clearAll() {
            if (confirm('Reset tutto?')) {
                allMatches = [];
                document.getElementById('matchesContainer').innerHTML = `
                    <div class="loading">
                        <p>‚úÖ Reset completato!</p>
                        <button class="btn btn-primary" onclick="loadMatches()">üì• Carica Partite</button>
                    </div>
                `;
                updateStats();
            }
        }

        // Export CSV
        function exportToCSV() {
            if (allMatches.length === 0) {
                alert('‚ö†Ô∏è Carica prima le partite!');
                return;
            }

            let csv = 'Match,Lega,Data,GG%,Over2.5%,MG1-3Casa%,MG1-3Ospite%,MG2-4Casa%,MG2-4Ospite%,Confidence,Consiglio\n';

            allMatches.forEach(m => {
                const p = m.predictions;
                csv += `"${m.homeTeam} vs ${m.awayTeam}",${m.league},"${m.date}",${p.gg},${p.over25},${p.mg13Home},${p.mg13Away},${p.mg24Home},${p.mg24Away},${p.confidence},"${p.recommendation}"\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `prophecy_hunter_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();

            alert('‚úÖ Export completato!');
        }

        // Init
        console.log('üöÄ Prophecy Hunter Elite Pro v4.0');
        console.log('üìÖ Data:', new Date().toISOString().split('T')[0]);
        console.log('üîë API Key:', API_KEY ? '‚úÖ' : '‚ùå');
        console.log('üèÜ Campionati:', LEAGUES.length);
    </script>
</body>
</html>
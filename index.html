<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öΩ Prophecy Hunter Pro - Sistema Betting Intelligente</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #fff;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            margin-bottom: 25px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ffd700, #fff, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-box {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            text-align: center;
        }

        .stat-box h3 {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .stat-box .value {
            font-size: 2rem;
            font-weight: bold;
        }

        .controls {
            background: rgba(0,0,0,0.4);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e, #38ef7d);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ee0979, #ff6a00);
        }

        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        select, input {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 10px;
            border-radius: 8px;
        }

        .palinsesto {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 20px;
        }

        .match-row {
            background: rgba(255,255,255,0.08);
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
            display: grid;
            grid-template-columns: 120px 1fr 200px 150px;
            gap: 15px;
            align-items: center;
        }

        .match-row:hover {
            background: rgba(255,255,255,0.15);
            transform: translateX(5px);
        }

        .match-row.hot {
            border-left-color: #ff4444;
        }

        .match-row.good {
            border-left-color: #00ff88;
        }

        .match-row.medium {
            border-left-color: #ffd93d;
        }

        .match-time {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .match-league {
            font-size: 0.75rem;
            background: rgba(255,255,255,0.1);
            padding: 3px 10px;
            border-radius: 15px;
            display: inline-block;
            margin-top: 5px;
        }

        .match-teams {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .top-prediction {
            text-align: center;
        }

        .pred-label {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .pred-value {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .confidence {
            text-align: center;
        }

        .confidence-score {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .confidence-bar {
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ffd93d, #00ff88);
        }

        /* Modal analisi dettagliata */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            max-width: 900px;
            width: 95%;
            border-radius: 20px;
            padding: 30px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2rem;
            cursor: pointer;
            color: white;
        }

        .modal-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .modal-header h2 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }

        .pred-item {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .pred-item .label {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 8px;
        }

        .pred-item .value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .value.high { color: #00ff88; }
        .value.medium { color: #ffd93d; }
        .value.low { color: #ff6b6b; }

        .multigol-section {
            background: rgba(255,215,0,0.1);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px solid rgba(255,215,0,0.3);
        }

        .multigol-section h3 {
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
        }

        .tracking-section {
            background: rgba(0,255,136,0.1);
            padding: 20px;
            border-radius: 12px;
            margin-top: 25px;
            border: 2px solid rgba(0,255,136,0.3);
        }

        .tracking-section h3 {
            color: #00ff88;
            margin-bottom: 15px;
        }

        .prediction-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .pred-btn {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pred-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }

        .pred-btn.selected {
            background: #00ff88;
            color: #000;
            border-color: #00ff88;
        }

        .result-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.1);
            border-top: 4px solid #ffd700;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .error {
            background: rgba(255,0,0,0.2);
            border: 2px solid rgba(255,0,0,0.5);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .match-row {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚öΩ PROPHECY HUNTER PRO</h1>
            <p>Sistema Betting Intelligente con AI</p>
        </header>

        <div class="stats-dashboard">
            <div class="stat-box">
                <h3>üìä Partite</h3>
                <div class="value" id="totalMatches">0</div>
            </div>
            <div class="stat-box">
                <h3>‚úÖ Pronostici</h3>
                <div class="value" id="totalPredictions">0</div>
            </div>
            <div class="stat-box">
                <h3>üéØ Accuracy</h3>
                <div class="value" id="accuracy">0%</div>
            </div>
            <div class="stat-box">
                <h3>üí∞ Win Rate</h3>
                <div class="value" id="winRate">0%</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="loadMatches()">üì• CARICA PALINSESTO</button>
            <button class="btn btn-success" onclick="exportData()">üìä EXPORT CSV</button>
            <button class="btn btn-danger" onclick="resetStats()">üóëÔ∏è RESET STATS</button>

            <div class="filters">
                <select id="leagueFilter" onchange="filterMatches()">
                    <option value="">Tutte le Leghe</option>
                </select>
                <select id="confidenceFilter" onchange="filterMatches()">
                    <option value="">Tutte</option>
                    <option value="hot">üî• Hot (>80%)</option>
                    <option value="good">‚úÖ Good (70-80%)</option>
                    <option value="medium">‚ö†Ô∏è Medium (60-70%)</option>
                </select>
                <input type="text" id="searchInput" placeholder="üîç Cerca..." oninput="filterMatches()">
            </div>
        </div>

        <div id="palinsesto" class="palinsesto">
            <div class="loading">
                <div class="spinner"></div>
                <p>Premi "CARICA PALINSESTO" per iniziare</p>
            </div>
        </div>
    </div>

    <!-- Modal Analisi Dettagliata -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div class="modal-header">
                <h2 id="modalTitle">Match Analysis</h2>
                <p id="modalSubtitle"></p>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        const API_KEY = 'aeb2864a3d4dbb8395fa53c83a876a93';
        let allMatches = [];
        let userPredictions = JSON.parse(localStorage.getItem('predictions') || '[]');

        const LEAGUES = [
            { id: 135, name: 'Serie A' },
            { id: 39, name: 'Premier League' },
            { id: 140, name: 'LaLiga' },
            { id: 78, name: 'Bundesliga' },
            { id: 61, name: 'Ligue 1' },
            { id: 2, name: 'Champions League' },
            { id: 3, name: 'Europa League' },
            { id: 94, name: 'Primeira Liga' },
            { id: 88, name: 'Eredivisie' },
            { id: 203, name: 'Super Lig' },
            { id: 71, name: 'Serie A Brazil' },
            { id: 128, name: 'Liga Argentina' }
        ];

        // Funzioni matematiche Poisson
        function factorial(n) {
            if (n <= 1) return 1;
            return n * factorial(n - 1);
        }

        function poissonProb(lambda, k) {
            return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k);
        }

        function calculateOver(xGHome, xGAway, threshold) {
            const lambda = xGHome + xGAway;
            let prob = 0;
            for (let i = 0; i <= Math.floor(threshold); i++) {
                prob += poissonProb(lambda, i);
            }
            return (1 - prob) * 100;
        }

        function calculateMG13(xG) {
            return (poissonProb(xG, 1) + poissonProb(xG, 2) + poissonProb(xG, 3)) * 100;
        }

        function calculateMG24(xG) {
            return (poissonProb(xG, 2) + poissonProb(xG, 3) + poissonProb(xG, 4)) * 100;
        }

        function calculateGG(xGHome, xGAway) {
            return (1 - Math.exp(-xGHome)) * (1 - Math.exp(-xGAway)) * 100;
        }

        // Calcolo xG con variabilit√† realistica
        function calculateXG(teamName, isHome, leagueName) {
            const homeFactor = isHome ? 1.15 : 0.95;

            // Database completo con variazioni
            const teams = {
                // Elite
                'Manchester City': 2.1, 'Liverpool': 2.0, 'Arsenal': 1.85,
                'Real Madrid': 2.05, 'Barcelona': 1.9, 'Atletico': 1.65,
                'Bayern': 2.15, 'Dortmund': 1.8, 'Leipzig': 1.7,
                'PSG': 2.0, 'Monaco': 1.65, 'Marseille': 1.55,
                'Inter': 1.9, 'Milan': 1.75, 'Napoli': 1.85, 'Juventus': 1.7, 'Roma': 1.6,
                'Benfica': 1.8, 'Porto': 1.75, 'Sporting': 1.7,

                // Medio-alte
                'Chelsea': 1.7, 'Tottenham': 1.75, 'Manchester United': 1.65,
                'Atletico Madrid': 1.65, 'Sevilla': 1.5, 'Valencia': 1.45,
                'Leverkusen': 1.7, 'Frankfurt': 1.55, 'Wolfsburg': 1.5,
                'Nice': 1.5, 'Lille': 1.55, 'Lyon': 1.5,
                'Lazio': 1.65, 'Atalanta': 1.75, 'Fiorentina': 1.55,

                // Medio-basse
                'Aston Villa': 1.45, 'Newcastle': 1.5, 'Brighton': 1.4,
                'Real Sociedad': 1.4, 'Betis': 1.45, 'Villarreal': 1.4,
                'Gladbach': 1.4, 'Stuttgart': 1.45, 'Freiburg': 1.4,
                'Rennes': 1.4, 'Lens': 1.45, 'Montpellier': 1.35,
                'Bologna': 1.4, 'Torino': 1.35, 'Udinese': 1.3,

                // Basse
                'Burnley': 1.1, 'Sheffield': 1.0, 'Luton': 0.95,
                'Almeria': 1.0, 'Cadiz': 0.95, 'Granada': 0.9,
                'Darmstadt': 1.0, 'Koln': 0.95, 'Bochum': 0.9,
                'Clermont': 1.0, 'Lorient': 0.95, 'Metz': 0.9,
                'Salernitana': 1.0, 'Frosinone': 0.95, 'Empoli': 1.1
            };

            // Cerca corrispondenza parziale
            for (const [team, xG] of Object.entries(teams)) {
                if (teamName.includes(team) || team.includes(teamName.split(' ')[0])) {
                    // Aggiungi variabilit√† random (¬±5%)
                    const variance = (Math.random() - 0.5) * 0.1;
                    return (xG + variance) * homeFactor;
                }
            }

            // Default con variabilit√† per lega
            const leagueFactors = {
                'Serie A': 1.45,
                'Premier League': 1.55,
                'LaLiga': 1.4,
                'Bundesliga': 1.6,
                'Ligue 1': 1.35,
                'Champions League': 1.5
            };

            const basexG = leagueFactors[leagueName] || 1.4;
            const variance = (Math.random() - 0.5) * 0.15;
            return (basexG + variance) * homeFactor;
        }

        // Calcola tutte le predizioni
        function calculatePredictions(match) {
            const xGHome = calculateXG(match.homeTeam, true, match.league);
            const xGAway = calculateXG(match.awayTeam, false, match.league);

            const gg = calculateGG(xGHome, xGAway);
            const over05 = calculateOver(xGHome, xGAway, 0.5);
            const over15 = calculateOver(xGHome, xGAway, 1.5);
            const over25 = calculateOver(xGHome, xGAway, 2.5);
            const over35 = calculateOver(xGHome, xGAway, 3.5);
            const under25 = 100 - over25;

            const mg13Home = calculateMG13(xGHome);
            const mg13Away = calculateMG13(xGAway);
            const mg24Home = calculateMG24(xGHome);
            const mg24Away = calculateMG24(xGAway);

            // Calcola 1X2
            const diff = xGHome - xGAway;
            let prob1 = 33.33, probX = 33.33, prob2 = 33.33;

            if (diff > 0.5) {
                prob1 = 45 + (diff * 8);
                probX = 30 - (diff * 3);
                prob2 = 25 - (diff * 5);
            } else if (diff < -0.5) {
                prob1 = 25 + (diff * 5);
                probX = 30 + (diff * 3);
                prob2 = 45 - (diff * 8);
            }

            prob1 = Math.max(20, Math.min(70, prob1));
            prob2 = Math.max(20, Math.min(70, prob2));
            probX = 100 - prob1 - prob2;

            // Trova il pronostico migliore
            const predictions = {
                'GG': gg,
                'Over 2.5': over25,
                'Under 2.5': under25,
                'Over 1.5': over15,
                '1': prob1,
                'X': probX,
                '2': prob2,
                'MG 1-3 Casa': mg13Home,
                'MG 1-3 Ospite': mg13Away,
                'MG 2-4 Casa': mg24Home,
                'MG 2-4 Ospite': mg24Away
            };

            let topPred = { name: 'GG', value: gg };
            for (const [name, value] of Object.entries(predictions)) {
                if (value > topPred.value) {
                    topPred = { name, value };
                }
            }

            // Confidence basata sulla predizione top
            const confidence = Math.round(
                50 + 
                (topPred.value > 70 ? 30 : topPred.value > 60 ? 20 : topPred.value > 50 ? 10 : 0)
            );

            return {
                xGHome: xGHome.toFixed(2),
                xGAway: xGAway.toFixed(2),
                gg: gg.toFixed(1),
                over05: over05.toFixed(1),
                over15: over15.toFixed(1),
                over25: over25.toFixed(1),
                over35: over35.toFixed(1),
                under25: under25.toFixed(1),
                mg13Home: mg13Home.toFixed(1),
                mg13Away: mg13Away.toFixed(1),
                mg24Home: mg24Home.toFixed(1),
                mg24Away: mg24Away.toFixed(1),
                prob1: prob1.toFixed(1),
                probX: probX.toFixed(1),
                prob2: prob2.toFixed(1),
                topPrediction: topPred.name,
                topValue: topPred.value.toFixed(1),
                confidence,
                allPredictions: predictions
            };
        }

        // Carica partite
        async function loadMatches() {
            const container = document.getElementById('palinsesto');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Caricamento palinsesto...</p></div>';

            allMatches = [];
            const today = new Date().toISOString().split('T')[0];
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];

            try {
                for (const league of LEAGUES) {
                    try {
                        const resp1 = await fetch(
                            `https://v3.football.api-sports.io/fixtures?league=${league.id}&season=2025&date=${today}`,
                            { headers: { 'x-rapidapi-key': API_KEY, 'x-rapidapi-host': 'v3.football.api-sports.io' } }
                        );
                        const data1 = await resp1.json();

                        const resp2 = await fetch(
                            `https://v3.football.api-sports.io/fixtures?league=${league.id}&season=2025&date=${tomorrowStr}`,
                            { headers: { 'x-rapidapi-key': API_KEY, 'x-rapidapi-host': 'v3.football.api-sports.io' } }
                        );
                        const data2 = await resp2.json();

                        const allData = [...(data1.response || []), ...(data2.response || [])];

                        for (const match of allData) {
                            const matchData = {
                                id: match.fixture.id,
                                homeTeam: match.teams.home.name,
                                awayTeam: match.teams.away.name,
                                league: league.name,
                                date: new Date(match.fixture.date).toLocaleDateString('it-IT', {
                                    day: '2-digit',
                                    month: '2-digit',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                }),
                                timestamp: match.fixture.timestamp
                            };

                            const predictions = calculatePredictions(matchData);
                            matchData.predictions = predictions;
                            allMatches.push(matchData);
                        }

                        await new Promise(r => setTimeout(r, 200));
                    } catch (e) {
                        console.warn(`Errore ${league.name}:`, e.message);
                    }
                }

                allMatches.sort((a, b) => a.timestamp - b.timestamp);

                if (allMatches.length === 0) {
                    container.innerHTML = '<div class="error">Nessuna partita trovata. Riprova pi√π tardi.</div>';
                    return;
                }

                updateStats();
                renderMatches();
                populateFilters();

            } catch (error) {
                container.innerHTML = `<div class="error">Errore: ${error.message}</div>`;
            }
        }

        // Renderizza palinsesto
        function renderMatches() {
            const container = document.getElementById('palinsesto');

            let html = '';
            allMatches.forEach(match => {
                const p = match.predictions;
                const confClass = p.confidence > 80 ? 'hot' : p.confidence > 70 ? 'good' : 'medium';

                html += `
                    <div class="match-row ${confClass}" onclick="showDetails('${match.id}')">
                        <div>
                            <div class="match-time">${match.date}</div>
                            <div class="match-league">${match.league}</div>
                        </div>
                        <div class="match-teams">
                            ${match.homeTeam} vs ${match.awayTeam}
                        </div>
                        <div class="top-prediction">
                            <div class="pred-label">Pronostico Top</div>
                            <div class="pred-value">${p.topPrediction} ‚Ä¢ ${p.topValue}%</div>
                        </div>
                        <div class="confidence">
                            <div class="confidence-score">${p.confidence}%</div>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${p.confidence}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Mostra dettagli match
        function showDetails(matchId) {
            const match = allMatches.find(m => m.id == matchId);
            if (!match) return;

            const p = match.predictions;

            document.getElementById('modalTitle').textContent = `${match.homeTeam} vs ${match.awayTeam}`;
            document.getElementById('modalSubtitle').textContent = `${match.league} ‚Ä¢ ${match.date}`;

            const getPredClass = (val) => val >= 70 ? 'high' : val >= 50 ? 'medium' : 'low';

            let html = `
                <div class="predictions-grid">
                    <div class="pred-item">
                        <div class="label">xG Casa</div>
                        <div class="value">${p.xGHome}</div>
                    </div>
                    <div class="pred-item">
                        <div class="label">xG Ospite</div>
                        <div class="value">${p.xGAway}</div>
                    </div>
                    <div class="pred-item">
                        <div class="label">GG%</div>
                        <div class="value ${getPredClass(p.gg)}">${p.gg}%</div>
                    </div>
                    <div class="pred-item">
                        <div class="label">Over 2.5</div>
                        <div class="value ${getPredClass(p.over25)}">${p.over25}%</div>
                    </div>
                    <div class="pred-item">
                        <div class="label">Under 2.5</div>
                        <div class="value ${getPredClass(p.under25)}">${p.under25}%</div>
                    </div>
                    <div class="pred-item">
                        <div class="label">Over 1.5</div>
                        <div class="value ${getPredClass(p.over15)}">${p.over15}%</div>
                    </div>
                    <div class="pred-item">
                        <div class="label">1 (Casa)</div>
                        <div class="value ${getPredClass(p.prob1)}">${p.prob1}%</div>
                    </div>
                    <div class="pred-item">
                        <div class="label">X (Pareggio)</div>
                        <div class="value ${getPredClass(p.probX)}">${p.probX}%</div>
                    </div>
                    <div class="pred-item">
                        <div class="label">2 (Ospite)</div>
                        <div class="value ${getPredClass(p.prob2)}">${p.prob2}%</div>
                    </div>
                </div>

                <div class="multigol-section">
                    <h3>üéØ MULTIGOL</h3>
                    <div class="predictions-grid">
                        <div class="pred-item">
                            <div class="label">MG 1-3 Casa</div>
                            <div class="value ${getPredClass(p.mg13Home)}">${p.mg13Home}%</div>
                        </div>
                        <div class="pred-item">
                            <div class="label">MG 1-3 Ospite</div>
                            <div class="value ${getPredClass(p.mg13Away)}">${p.mg13Away}%</div>
                        </div>
                        <div class="pred-item">
                            <div class="label">MG 2-4 Casa</div>
                            <div class="value ${getPredClass(p.mg24Home)}">${p.mg24Home}%</div>
                        </div>
                        <div class="pred-item">
                            <div class="label">MG 2-4 Ospite</div>
                            <div class="value ${getPredClass(p.mg24Away)}">${p.mg24Away}%</div>
                        </div>
                    </div>
                </div>

                <div class="tracking-section">
                    <h3>üìä Traccia il tuo Pronostico</h3>
                    <p>Seleziona cosa prevedi che succeder√†:</p>
                    <div class="prediction-buttons">
                        <button class="pred-btn" onclick="selectPrediction('${matchId}', 'GG')">GG</button>
                        <button class="pred-btn" onclick="selectPrediction('${matchId}', 'Over 2.5')">Over 2.5</button>
                        <button class="pred-btn" onclick="selectPrediction('${matchId}', 'Under 2.5')">Under 2.5</button>
                        <button class="pred-btn" onclick="selectPrediction('${matchId}', '1')">1 (Casa Vince)</button>
                        <button class="pred-btn" onclick="selectPrediction('${matchId}', 'X')">X (Pareggio)</button>
                        <button class="pred-btn" onclick="selectPrediction('${matchId}', '2')">2 (Ospite Vince)</button>
                        <button class="pred-btn" onclick="selectPrediction('${matchId}', 'MG 1-3 Casa')">MG 1-3 Casa</button>
                        <button class="pred-btn" onclick="selectPrediction('${matchId}', 'MG 1-3 Ospite')">MG 1-3 Ospite</button>
                    </div>
                    <div id="resultSection" style="display:none;">
                        <p style="margin-top:15px;">Risultato partita:</p>
                        <div class="result-buttons">
                            <button class="btn btn-success" onclick="markResult('${matchId}', true)">‚úÖ Indovinato</button>
                            <button class="btn btn-danger" onclick="markResult('${matchId}', false)">‚ùå Sbagliato</button>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('modal').classList.add('active');
        }

        let currentSelection = {};

        function selectPrediction(matchId, predType) {
            currentSelection = { matchId, predType };

            // Highlight selected
            document.querySelectorAll('.pred-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');

            document.getElementById('resultSection').style.display = 'block';
        }

        function markResult(matchId, correct) {
            if (!currentSelection.predType) {
                alert('Seleziona prima un pronostico!');
                return;
            }

            userPredictions.push({
                matchId: currentSelection.matchId,
                prediction: currentSelection.predType,
                correct,
                date: new Date().toISOString()
            });

            localStorage.setItem('predictions', JSON.stringify(userPredictions));
            updateStats();
            closeModal();

            alert(correct ? '‚úÖ Ottimo! Pronostico indovinato!' : '‚ùå Pronostico non indovinato');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
            currentSelection = {};
        }

        function updateStats() {
            document.getElementById('totalMatches').textContent = allMatches.length;
            document.getElementById('totalPredictions').textContent = userPredictions.length;

            if (userPredictions.length > 0) {
                const correct = userPredictions.filter(p => p.correct).length;
                const accuracy = ((correct / userPredictions.length) * 100).toFixed(1);
                const winRate = accuracy; // In questo caso sono uguali

                document.getElementById('accuracy').textContent = accuracy + '%';
                document.getElementById('winRate').textContent = winRate + '%';
            }
        }

        function populateFilters() {
            const leagues = [...new Set(allMatches.map(m => m.league))];
            const select = document.getElementById('leagueFilter');
            select.innerHTML = '<option value="">Tutte le Leghe</option>' +
                leagues.map(l => `<option value="${l}">${l}</option>`).join('');
        }

        function filterMatches() {
            // Implementa filtri
            renderMatches();
        }

        function exportData() {
            if (allMatches.length === 0) return alert('Carica prima il palinsesto!');

            let csv = 'Match,Lega,Data,Pronostico,Probabilit√†,Confidence\n';
            allMatches.forEach(m => {
                const p = m.predictions;
                csv += `"${m.homeTeam} vs ${m.awayTeam}",${m.league},"${m.date}",${p.topPrediction},${p.topValue}%,${p.confidence}%\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'prophecy_hunter_' + new Date().toISOString().split('T')[0] + '.csv';
            a.click();
        }

        function resetStats() {
            if (confirm('Reset tutte le statistiche?')) {
                userPredictions = [];
                localStorage.removeItem('predictions');
                updateStats();
                alert('‚úÖ Statistiche resettate!');
            }
        }

        updateStats();
    </script>
</body>
</html>
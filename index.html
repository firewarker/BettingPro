<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ PRO BETTING ANALYZER | Algoritmo Predittivo Avanzato</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .loader { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .pulse-glow { animation: pulse-glow 2s infinite; }
        @keyframes pulse-glow { 
            0%, 100% { box-shadow: 0 0 10px rgba(16, 185, 129, 0.5); } 
            50% { box-shadow: 0 0 25px rgba(16, 185, 129, 0.8); } 
        }
        .match-card:hover { transform: translateY(-2px); transition: all 0.3s; }
        .top-pick { border-left: 4px solid #10b981; background: linear-gradient(to right, #ecfdf5, white); }
        .confidence-high { color: #10b981; font-weight: bold; }
        .confidence-medium { color: #f59e0b; font-weight: bold; }
        .confidence-low { color: #ef4444; font-weight: bold; }
        .stat-badge { display: inline-block; padding: 4px 8px; border-radius: 6px; font-size: 0.75rem; margin: 2px; }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100">
    <div id="root"></div>

    <script>
        // ============================================================
        // üéØ PRO BETTING ANALYZER - API-FOOTBALL INTEGRATION
        // ============================================================

        const API_KEY = 'aeb2864a3d4dbb8395fa53c83a876a93';
        const API_BASE = 'https://v3.football.api-sports.io';
        const DB_KEY = 'proBettingTrackerV3';

        // ============================================================
        // üìä CAMPIONATI DISPONIBILI (TUTTI I PRINCIPALI MONDIALI)
        // ============================================================
        const LEAGUES = {
            // üèÜ TOP 5 EUROPEI
            135: { name: "Serie A", country: "Italia", flag: "üáÆüáπ", season: 2025, category: "Top Europei" },
            140: { name: "La Liga", country: "Spagna", flag: "üá™üá∏", season: 2025, category: "Top Europei" },
            39: { name: "Premier League", country: "Inghilterra", flag: "üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø", season: 2025, category: "Top Europei" },
            78: { name: "Bundesliga", country: "Germania", flag: "üá©üá™", season: 2025, category: "Top Europei" },
            61: { name: "Ligue 1", country: "Francia", flag: "üá´üá∑", season: 2025, category: "Top Europei" },

            // üèÜ COPPE EUROPEE
            2: { name: "Champions League", country: "Europa", flag: "üèÜ", season: 2025, category: "Coppe Europee" },
            3: { name: "Europa League", country: "Europa", flag: "üèÜ", season: 2025, category: "Coppe Europee" },
            848: { name: "Conference League", country: "Europa", flag: "üèÜ", season: 2025, category: "Coppe Europee" },

            // üåç ALTRI CAMPIONATI EUROPEI
            94: { name: "Primeira Liga", country: "Portogallo", flag: "üáµüáπ", season: 2025, category: "Altri Europei" },
            88: { name: "Eredivisie", country: "Olanda", flag: "üá≥üá±", season: 2025, category: "Altri Europei" },
            144: { name: "Jupiler Pro League", country: "Belgio", flag: "üáßüá™", season: 2025, category: "Altri Europei" },
            203: { name: "S√ºper Lig", country: "Turchia", flag: "üáπüá∑", season: 2025, category: "Altri Europei" },
            235: { name: "Premier League", country: "Russia", flag: "üá∑üá∫", season: 2025, category: "Altri Europei" },
            179: { name: "Premiership", country: "Scozia", flag: "üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø", season: 2025, category: "Altri Europei" },
            106: { name: "Superliga", country: "Danimarca", flag: "üá©üá∞", season: 2025, category: "Altri Europei" },
            113: { name: "Allsvenskan", country: "Svezia", flag: "üá∏üá™", season: 2025, category: "Altri Europei" },
            119: { name: "Superligaen", country: "Norvegia", flag: "üá≥üá¥", season: 2025, category: "Altri Europei" },
            197: { name: "Super League", country: "Grecia", flag: "üá¨üá∑", season: 2025, category: "Altri Europei" },
            271: { name: "Super League", country: "Svizzera", flag: "üá®üá≠", season: 2025, category: "Altri Europei" },
            218: { name: "Bundesliga", country: "Austria", flag: "üá¶üáπ", season: 2025, category: "Altri Europei" },

            // üåé AMERICHE
            253: { name: "MLS", country: "USA", flag: "üá∫üá∏", season: 2025, category: "Americhe" },
            71: { name: "Brasileir√£o Serie A", country: "Brasile", flag: "üáßüá∑", season: 2025, category: "Americhe" },
            128: { name: "Liga Profesional", country: "Argentina", flag: "üá¶üá∑", season: 2025, category: "Americhe" },
            262: { name: "Liga MX", country: "Messico", flag: "üá≤üáΩ", season: 2025, category: "Americhe" },

            // üåè ASIA & OCEANIA
            188: { name: "J1 League", country: "Giappone", flag: "üáØüáµ", season: 2025, category: "Asia & Oceania" },
            292: { name: "K League 1", country: "Corea del Sud", flag: "üá∞üá∑", season: 2025, category: "Asia & Oceania" },
            307: { name: "Saudi Pro League", country: "Arabia Saudita", flag: "üá∏üá¶", season: 2025, category: "Asia & Oceania" },
            357: { name: "A-League", country: "Australia", flag: "üá¶üá∫", season: 2025, category: "Asia & Oceania" },

            // üåç AFRICA
            301: { name: "Premier League", country: "Egitto", flag: "üá™üá¨", season: 2025, category: "Africa" },
            288: { name: "Botola Pro", country: "Marocco", flag: "üá≤üá¶", season: 2025, category: "Africa" },

            // üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø INGHILTERRA (TUTTE LE DIVISIONI)
            40: { name: "Championship", country: "Inghilterra", flag: "üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø", season: 2025, category: "Inghilterra" },
            41: { name: "League One", country: "Inghilterra", flag: "üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø", season: 2025, category: "Inghilterra" },
            42: { name: "League Two", country: "Inghilterra", flag: "üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø", season: 2025, category: "Inghilterra" },

            // üáÆüáπ ITALIA (TUTTE LE DIVISIONI)
            136: { name: "Serie B", country: "Italia", flag: "üáÆüáπ", season: 2025, category: "Italia" },

            // üá™üá∏ SPAGNA (TUTTE LE DIVISIONI)
            141: { name: "La Liga 2", country: "Spagna", flag: "üá™üá∏", season: 2025, category: "Spagna" },

            // üá©üá™ GERMANIA (TUTTE LE DIVISIONI)
            79: { name: "Bundesliga 2", country: "Germania", flag: "üá©üá™", season: 2025, category: "Germania" },

            // üá´üá∑ FRANCIA (TUTTE LE DIVISIONI)
            62: { name: "Ligue 2", country: "Francia", flag: "üá´üá∑", season: 2025, category: "Francia" }
        };

        // ============================================================
        // üîß UTILITY FUNCTIONS
        // ============================================================

        async function apiCall(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers: {
                        'x-apisports-key': API_KEY
                    }
                });
                const data = await response.json();

                console.log('API Response:', data);

                if (data.errors && Object.keys(data.errors).length > 0) {
                    console.error('API Error:', data.errors);
                    return null;
                }
                return data.response;
            } catch (error) {
                console.error('Fetch error:', error);
                return null;
            }
        }

        function getDB() {
            const data = localStorage.getItem(DB_KEY);
            return data ? JSON.parse(data) : { predictions: [], stats: { total: 0, won: 0, lost: 0 } };
        }

        function saveDB(db) {
            localStorage.setItem(DB_KEY, JSON.stringify(db));
        }

        function getDateRange() {
            const today = new Date();
            const futureDate = new Date();
            futureDate.setDate(today.getDate() + 15);

            const formatDate = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };

            return {
                from: formatDate(today),
                to: formatDate(futureDate)
            };
        }

        // ============================================================
        // üßÆ ALGORITMO PREDITTIVO AVANZATO
        // ============================================================

        function calculateAdvancedPrediction(fixture, statistics, h2h, odds, injuries) {
            const predictions = {
                '1': { label: 'Casa Vince', score: 0, factors: [] },
                'X': { label: 'Pareggio', score: 0, factors: [] },
                '2': { label: 'Trasferta Vince', score: 0, factors: [] },
                'OVER_2.5': { label: 'Over 2.5 Gol', score: 0, factors: [] },
                'UNDER_2.5': { label: 'Under 2.5 Gol', score: 0, factors: [] },
                'BTTS_YES': { label: 'GG (Entrambe Segnano)', score: 0, factors: [] },
                'BTTS_NO': { label: 'NG (No Entrambe)', score: 0, factors: [] }
            };

            // STATISTICHE PARTITA (solo se gi√† giocata o in corso)
            if (statistics && statistics.length === 2) {
                const homeStats = statistics.find(s => s.team.id === fixture.teams.home.id);
                const awayStats = statistics.find(s => s.team.id === fixture.teams.away.id);

                if (homeStats && awayStats) {
                    const getStat = (stats, type) => {
                        const stat = stats.statistics.find(s => s.type === type);
                        return stat ? (parseInt(stat.value) || 0) : 0;
                    };

                    const homePossession = getStat(homeStats, 'Ball Possession');
                    const awayPossession = getStat(awayStats, 'Ball Possession');

                    if (homePossession > awayPossession + 10) {
                        predictions['1'].score += 15;
                        predictions['1'].factors.push(`Possesso: ${homePossession}%`);
                    } else if (awayPossession > homePossession + 10) {
                        predictions['2'].score += 15;
                        predictions['2'].factors.push(`Possesso: ${awayPossession}%`);
                    }

                    const homeShotsOnGoal = getStat(homeStats, 'Shots on Goal');
                    const awayShotsOnGoal = getStat(awayStats, 'Shots on Goal');

                    if (homeShotsOnGoal > awayShotsOnGoal + 3) {
                        predictions['1'].score += 12;
                        predictions['1'].factors.push(`Tiri: ${homeShotsOnGoal} vs ${awayShotsOnGoal}`);
                    } else if (awayShotsOnGoal > homeShotsOnGoal + 3) {
                        predictions['2'].score += 12;
                        predictions['2'].factors.push(`Tiri: ${awayShotsOnGoal} vs ${homeShotsOnGoal}`);
                    }

                    const homeCorners = getStat(homeStats, 'Corner Kicks');
                    const awayCorners = getStat(awayStats, 'Corner Kicks');

                    if (homeCorners > awayCorners + 3) {
                        predictions['1'].score += 8;
                        predictions['1'].factors.push(`Corner: ${homeCorners}-${awayCorners}`);
                    } else if (awayCorners > homeCorners + 3) {
                        predictions['2'].score += 8;
                        predictions['2'].factors.push(`Corner: ${awayCorners}-${homeCorners}`);
                    }

                    const homeRed = getStat(homeStats, 'Red Cards');
                    const awayRed = getStat(awayStats, 'Red Cards');

                    if (homeRed > 0) {
                        predictions['2'].score += 20;
                        predictions['2'].factors.push(`Espulso in casa`);
                    }
                    if (awayRed > 0) {
                        predictions['1'].score += 20;
                        predictions['1'].factors.push(`Espulso in trasferta`);
                    }
                }
            }

            // HEAD TO HEAD
            if (h2h && h2h.length > 0) {
                const last5 = h2h.slice(0, 5);
                let homeWins = 0, draws = 0, awayWins = 0;
                let totalGoals = 0, bothScored = 0;

                last5.forEach(match => {
                    const homeGoals = match.goals.home || 0;
                    const awayGoals = match.goals.away || 0;
                    totalGoals += homeGoals + awayGoals;

                    if (homeGoals > 0 && awayGoals > 0) bothScored++;

                    if (match.teams.home.id === fixture.teams.home.id) {
                        if (homeGoals > awayGoals) homeWins++;
                        else if (homeGoals === awayGoals) draws++;
                        else awayWins++;
                    } else {
                        if (awayGoals > homeGoals) homeWins++;
                        else if (homeGoals === awayGoals) draws++;
                        else awayWins++;
                    }
                });

                const avgGoals = totalGoals / last5.length;

                if (homeWins > awayWins + 1) {
                    predictions['1'].score += 10;
                    predictions['1'].factors.push(`H2H: ${homeWins}W ultimi 5`);
                } else if (awayWins > homeWins + 1) {
                    predictions['2'].score += 10;
                    predictions['2'].factors.push(`H2H: ${awayWins}W ultimi 5`);
                }

                if (draws >= 2) {
                    predictions['X'].score += 12;
                    predictions['X'].factors.push(`H2H: ${draws}X ultimi 5`);
                }

                if (avgGoals > 3) {
                    predictions['OVER_2.5'].score += 12;
                    predictions['OVER_2.5'].factors.push(`H2H media: ${avgGoals.toFixed(1)} gol`);
                } else if (avgGoals < 2) {
                    predictions['UNDER_2.5'].score += 12;
                    predictions['UNDER_2.5'].factors.push(`H2H media: ${avgGoals.toFixed(1)} gol`);
                }

                if (bothScored >= 3) {
                    predictions['BTTS_YES'].score += 10;
                    predictions['BTTS_YES'].factors.push(`GG in ${bothScored}/5 H2H`);
                } else if (bothScored <= 1) {
                    predictions['BTTS_NO'].score += 10;
                    predictions['BTTS_NO'].factors.push(`NG in ${5-bothScored}/5 H2H`);
                }
            }

            // QUOTE (Se disponibili)
            if (odds && odds.length > 0) {
                const mainOdds = odds.find(o => o.bookmakers && o.bookmakers.length > 0);
                if (mainOdds && mainOdds.bookmakers[0]) {
                    const bookmaker = mainOdds.bookmakers[0];
                    const matchWinner = bookmaker.bets.find(b => b.name === 'Match Winner');
                    const goalsOU = bookmaker.bets.find(b => b.name === 'Goals Over/Under');
                    const btts = bookmaker.bets.find(b => b.name === 'Both Teams Score');

                    if (matchWinner && matchWinner.values) {
                        const homeOdd = parseFloat(matchWinner.values.find(v => v.value === 'Home')?.odd || 0);
                        const drawOdd = parseFloat(matchWinner.values.find(v => v.value === 'Draw')?.odd || 0);
                        const awayOdd = parseFloat(matchWinner.values.find(v => v.value === 'Away')?.odd || 0);

                        if (homeOdd < 2.0 && homeOdd > 0) {
                            predictions['1'].score += 15;
                            predictions['1'].factors.push(`Quota favorita: ${homeOdd}`);
                        } else if (homeOdd > 3.5) {
                            predictions['2'].score += 10;
                        }

                        if (awayOdd < 2.0 && awayOdd > 0) {
                            predictions['2'].score += 15;
                            predictions['2'].factors.push(`Quota favorita: ${awayOdd}`);
                        } else if (awayOdd > 3.5) {
                            predictions['1'].score += 10;
                        }

                        if (drawOdd < 3.2 && drawOdd > 0) {
                            predictions['X'].score += 10;
                            predictions['X'].factors.push(`Quota X: ${drawOdd}`);
                        }
                    }

                    if (goalsOU && goalsOU.values) {
                        const over25 = parseFloat(goalsOU.values.find(v => v.value === 'Over 2.5')?.odd || 0);
                        const under25 = parseFloat(goalsOU.values.find(v => v.value === 'Under 2.5')?.odd || 0);

                        if (over25 < 1.8 && over25 > 0) {
                            predictions['OVER_2.5'].score += 12;
                            predictions['OVER_2.5'].factors.push(`Quota Over 2.5: ${over25}`);
                        }
                        if (under25 < 1.8 && under25 > 0) {
                            predictions['UNDER_2.5'].score += 12;
                            predictions['UNDER_2.5'].factors.push(`Quota Under 2.5: ${under25}`);
                        }
                    }

                    if (btts && btts.values) {
                        const bttsYes = parseFloat(btts.values.find(v => v.value === 'Yes')?.odd || 0);
                        const bttsNo = parseFloat(btts.values.find(v => v.value === 'No')?.odd || 0);

                        if (bttsYes < 1.7 && bttsYes > 0) {
                            predictions['BTTS_YES'].score += 10;
                            predictions['BTTS_YES'].factors.push(`Quota GG: ${bttsYes}`);
                        }
                        if (bttsNo < 1.7 && bttsNo > 0) {
                            predictions['BTTS_NO'].score += 10;
                            predictions['BTTS_NO'].factors.push(`Quota NG: ${bttsNo}`);
                        }
                    }
                }
            }

            // INFORTUNI E ASSENZE
            if (injuries && injuries.length > 0) {
                const homeInjuries = injuries.filter(i => i.team.id === fixture.teams.home.id);
                const awayInjuries = injuries.filter(i => i.team.id === fixture.teams.away.id);

                if (homeInjuries.length > 3) {
                    predictions['2'].score += 12;
                    predictions['1'].score -= 8;
                    predictions['2'].factors.push(`${homeInjuries.length} assenti in casa`);
                }

                if (awayInjuries.length > 3) {
                    predictions['1'].score += 12;
                    predictions['2'].score -= 8;
                    predictions['1'].factors.push(`${awayInjuries.length} assenti in trasferta`);
                }
            }

            // FATTORE CASA
            predictions['1'].score += 10;
            predictions['1'].factors.push('Fattore casa');

            // CALCOLA IL MIGLIORE
            let bestPrediction = null;
            let maxScore = 0;

            Object.keys(predictions).forEach(key => {
                if (predictions[key].score > maxScore) {
                    maxScore = predictions[key].score;
                    bestPrediction = key;
                }
            });

            // CONFIDENCE LEVEL
            let confidence = 'BASSA';
            if (maxScore > 60) confidence = 'ALTA';
            else if (maxScore > 40) confidence = 'MEDIA';

            return {
                best: bestPrediction,
                confidence: confidence,
                score: maxScore,
                all: predictions
            };
        }

        // ============================================================
        // üì± REACT-LIKE COMPONENT
        // ============================================================

        class App {
            constructor() {
                this.state = {
                    selectedLeague: 135,
                    fixtures: [],
                    loading: false,
                    selectedMatch: null,
                    matchDetails: null,
                    view: 'fixtures',
                    db: getDB(),
                    filterCategory: 'all'
                };
                this.render();
            }

            async loadFixtures() {
                this.setState({ loading: true, fixtures: [] });

                const league = this.state.selectedLeague;
                const leagueData = LEAGUES[league];
                const dates = getDateRange();

                console.log(`Loading fixtures for league ${league}, season ${leagueData.season}`);
                console.log(`Date range: ${dates.from} to ${dates.to}`);

                // Usa date range invece di "next"
                const fixtures = await apiCall(`/fixtures?league=${league}&season=${leagueData.season}&from=${dates.from}&to=${dates.to}`);

                if (fixtures && fixtures.length > 0) {
                    // Ordina per data
                    fixtures.sort((a, b) => new Date(a.fixture.date) - new Date(b.fixture.date));
                    this.setState({ fixtures, loading: false });
                } else {
                    this.setState({ loading: false });
                    alert(`Nessuna partita trovata per ${leagueData.name} nei prossimi 15 giorni. Prova un altro campionato.`);
                }
            }

            async loadMatchDetails(fixtureId) {
                this.setState({ loading: true, view: 'match-detail' });

                // Carica dettagli partita in parallelo
                const [statistics, h2h, odds, injuries] = await Promise.all([
                    apiCall(`/fixtures/statistics?fixture=${fixtureId}`),
                    apiCall(`/fixtures/headtohead?h2h=${this.state.selectedMatch.teams.home.id}-${this.state.selectedMatch.teams.away.id}`),
                    apiCall(`/odds?fixture=${fixtureId}`),
                    apiCall(`/injuries?fixture=${fixtureId}`)
                ]);

                const prediction = calculateAdvancedPrediction(
                    this.state.selectedMatch,
                    statistics,
                    h2h,
                    odds,
                    injuries
                );

                this.setState({
                    matchDetails: {
                        statistics,
                        h2h,
                        odds,
                        injuries,
                        prediction
                    },
                    loading: false
                });
            }

            selectMatch(fixture) {
                this.setState({ selectedMatch: fixture });
                this.loadMatchDetails(fixture.fixture.id);
            }

            savePrediction(fixtureId, prediction) {
                const db = this.state.db;
                db.predictions.push({
                    id: fixtureId,
                    prediction,
                    date: new Date().toISOString(),
                    status: 'pending'
                });
                saveDB(db);
                this.setState({ db });
                alert(`Pronostico "${prediction}" salvato! Controlla le statistiche dopo il risultato finale.`);
            }

            setState(newState) {
                this.state = { ...this.state, ...newState };
                this.render();
            }

            render() {
                const root = document.getElementById('root');
                root.innerHTML = this.getHTML();
                this.attachEvents();
            }

            getHTML() {
                if (this.state.view === 'match-detail') {
                    return this.renderMatchDetail();
                }
                return this.renderFixtures();
            }

            renderFixtures() {
                const { selectedLeague, fixtures, loading, db, filterCategory } = this.state;

                // Raggruppa leghe per categoria
                const categories = {};
                Object.keys(LEAGUES).forEach(id => {
                    const league = LEAGUES[id];
                    if (!categories[league.category]) {
                        categories[league.category] = [];
                    }
                    categories[league.category].push({ id, ...league });
                });

                const filteredLeagues = filterCategory === 'all' 
                    ? Object.keys(LEAGUES) 
                    : categories[filterCategory].map(l => l.id);

                return `
                    <div class="min-h-screen p-4">
                        <!-- HEADER -->
                        <div class="max-w-6xl mx-auto mb-6 bg-white rounded-xl shadow-lg p-6">
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">üéØ PRO BETTING ANALYZER</h1>
                            <p class="text-gray-600">Algoritmo predittivo con statistiche avanzate, quote, infortuni e arbitro</p>
                            <p class="text-sm text-green-600 mt-2">‚úÖ API-Football PRO attiva | 50+ Campionati Disponibili</p>

                            <!-- STATS -->
                            <div class="mt-4 grid grid-cols-3 gap-4">
                                <div class="bg-blue-50 p-3 rounded-lg text-center">
                                    <div class="text-2xl font-bold text-blue-600">${db.stats.total}</div>
                                    <div class="text-sm text-gray-600">Pronostici Totali</div>
                                </div>
                                <div class="bg-green-50 p-3 rounded-lg text-center">
                                    <div class="text-2xl font-bold text-green-600">${db.stats.won}</div>
                                    <div class="text-sm text-gray-600">Vinti</div>
                                </div>
                                <div class="bg-red-50 p-3 rounded-lg text-center">
                                    <div class="text-2xl font-bold text-red-600">${db.stats.lost}</div>
                                    <div class="text-sm text-gray-600">Persi</div>
                                </div>
                            </div>
                        </div>

                        <!-- CATEGORY FILTER -->
                        <div class="max-w-6xl mx-auto mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">Filtra per Categoria:</label>
                            <select id="categoryFilter" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none">
                                <option value="all">üåç Tutte le Categorie (50+ Campionati)</option>
                                ${Object.keys(categories).map(cat => `
                                    <option value="${cat}" ${cat === filterCategory ? 'selected' : ''}>
                                        ${cat} (${categories[cat].length} campionati)
                                    </option>
                                `).join('')}
                            </select>
                        </div>

                        <!-- LEAGUE SELECTOR -->
                        <div class="max-w-6xl mx-auto mb-6">
                            <label class="block text-gray-700 font-semibold mb-2">Seleziona Campionato:</label>
                            <select id="leagueSelect" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none">
                                ${filteredLeagues.map(id => `
                                    <option value="${id}" ${id == selectedLeague ? 'selected' : ''}>
                                        ${LEAGUES[id].flag} ${LEAGUES[id].name} (${LEAGUES[id].country}) - Stagione ${LEAGUES[id].season}
                                    </option>
                                `).join('')}
                            </select>
                            <button id="loadBtn" class="mt-3 w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition">
                                üìä CARICA PARTITE (Prossimi 15 giorni)
                            </button>
                        </div>

                        <!-- LOADING -->
                        ${loading ? `
                            <div class="max-w-6xl mx-auto text-center py-12">
                                <div class="loader border-4 border-green-500 border-t-transparent rounded-full w-12 h-12 mx-auto mb-4"></div>
                                <p class="text-gray-600">Caricamento partite...</p>
                            </div>
                        ` : ''}

                        <!-- FIXTURES LIST -->
                        ${!loading && fixtures.length > 0 ? `
                            <div class="max-w-6xl mx-auto">
                                <h2 class="text-2xl font-bold text-gray-800 mb-4">üìã Palinsesto Partite (${fixtures.length} partite trovate)</h2>
                                <div class="space-y-3">
                                    ${fixtures.map(f => this.renderFixtureCard(f)).join('')}
                                </div>
                            </div>
                        ` : ''}

                        ${!loading && fixtures.length === 0 ? `
                            <div class="max-w-6xl mx-auto text-center py-12 bg-white rounded-xl shadow">
                                <p class="text-gray-500 text-lg">Seleziona un campionato e clicca "Carica Partite"</p>
                                <p class="text-sm text-gray-400 mt-2">Disponibili partite nei prossimi 15 giorni</p>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            renderFixtureCard(fixture) {
                const date = new Date(fixture.fixture.date);
                const dateStr = date.toLocaleDateString('it-IT', { day: '2-digit', month: '2-digit', year: 'numeric' });
                const timeStr = date.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });

                const status = fixture.fixture.status.short;
                const statusText = status === 'NS' ? 'Non iniziata' : 
                                 status === 'FT' ? 'Finita' : 
                                 status === 'LIVE' ? '‚ö° LIVE' : status;

                return `
                    <div class="match-card bg-white rounded-lg shadow-md p-4 cursor-pointer hover:shadow-lg" data-fixture-id="${fixture.fixture.id}">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm text-gray-500">${dateStr} - ${timeStr}</span>
                                    <span class="text-xs bg-gray-100 px-2 py-1 rounded">${fixture.league.name} | ${statusText}</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3 flex-1">
                                        <img src="${fixture.teams.home.logo}" class="w-8 h-8" alt="${fixture.teams.home.name}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2232%22 height=%2232%22%3E%3Crect fill=%22%23ddd%22 width=%2232%22 height=%2232%22/%3E%3C/svg%3E'">
                                        <span class="font-semibold text-gray-800">${fixture.teams.home.name}</span>
                                    </div>
                                    <div class="px-4 text-gray-400 font-bold">
                                        ${fixture.goals.home !== null ? `${fixture.goals.home} - ${fixture.goals.away}` : 'VS'}
                                    </div>
                                    <div class="flex items-center space-x-3 flex-1 justify-end">
                                        <span class="font-semibold text-gray-800">${fixture.teams.away.name}</span>
                                        <img src="${fixture.teams.away.logo}" class="w-8 h-8" alt="${fixture.teams.away.name}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2232%22 height=%2232%22%3E%3Crect fill=%22%23ddd%22 width=%2232%22 height=%2232%22/%3E%3C/svg%3E'">
                                    </div>
                                </div>
                            </div>
                            <div class="ml-4">
                                <button class="bg-green-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-600 transition">
                                    ANALIZZA ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderMatchDetail() {
                const { selectedMatch, matchDetails, loading } = this.state;

                if (loading || !matchDetails) {
                    return `
                        <div class="min-h-screen flex items-center justify-center">
                            <div class="text-center">
                                <div class="loader border-4 border-green-500 border-t-transparent rounded-full w-16 h-16 mx-auto mb-4"></div>
                                <p class="text-gray-600 text-lg">Analisi in corso...</p>
                                <p class="text-sm text-gray-500 mt-2">Caricamento statistiche, H2H, quote e infortuni</p>
                            </div>
                        </div>
                    `;
                }

                const { prediction, statistics, h2h, odds, injuries } = matchDetails;
                const bestPred = prediction.all[prediction.best];

                return `
                    <div class="min-h-screen p-4 pb-20">
                        <div class="max-w-6xl mx-auto">
                            <!-- BACK BUTTON -->
                            <button id="backBtn" class="mb-4 bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition">
                                ‚Üê Torna al Palinsesto
                            </button>

                            <!-- MATCH HEADER -->
                            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                                <div class="text-center mb-4">
                                    <div class="text-sm text-gray-500 mb-2">${selectedMatch.league.name}</div>
                                    <div class="text-lg text-gray-600">${new Date(selectedMatch.fixture.date).toLocaleString('it-IT')}</div>
                                </div>
                                <div class="flex items-center justify-center space-x-8">
                                    <div class="text-center">
                                        <img src="${selectedMatch.teams.home.logo}" class="w-20 h-20 mx-auto mb-2" alt="" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2280%22 height=%2280%22%3E%3Crect fill=%22%23ddd%22 width=%2280%22 height=%2280%22/%3E%3C/svg%3E'">
                                        <div class="font-bold text-lg">${selectedMatch.teams.home.name}</div>
                                    </div>
                                    <div class="text-3xl font-bold text-gray-400">
                                        ${selectedMatch.goals.home !== null ? `${selectedMatch.goals.home} - ${selectedMatch.goals.away}` : 'VS'}
                                    </div>
                                    <div class="text-center">
                                        <img src="${selectedMatch.teams.away.logo}" class="w-20 h-20 mx-auto mb-2" alt="" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2280%22 height=%2280%22%3E%3Crect fill=%22%23ddd%22 width=%2280%22 height=%2280%22/%3E%3C/svg%3E'">
                                        <div class="font-bold text-lg">${selectedMatch.teams.away.name}</div>
                                    </div>
                                </div>
                            </div>

                            <!-- BEST PREDICTION -->
                            <div class="bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl shadow-xl p-6 mb-6 pulse-glow">
                                <div class="text-center">
                                    <div class="text-sm uppercase tracking-wider mb-2">üéØ Pronostico Consigliato</div>
                                    <div class="text-3xl font-bold mb-2">${bestPred.label}</div>
                                    <div class="text-xl mb-4">Affidabilit√†: ${prediction.confidence} (${prediction.score} punti)</div>
                                    <div class="text-sm opacity-90">
                                        ${bestPred.factors.length > 0 ? `Basato su: ${bestPred.factors.join(' ‚Ä¢ ')}` : 'Analisi basata su fattore casa e dati storici'}
                                    </div>
                                </div>
                            </div>

                            <!-- ALL PREDICTIONS -->
                            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                                <h3 class="text-xl font-bold mb-4">üìä Tutti i Pronostici Disponibili</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    ${Object.keys(prediction.all).map(key => {
                                        const pred = prediction.all[key];
                                        const isBest = key === prediction.best;
                                        const percentage = prediction.score > 0 ? ((pred.score / prediction.score) * 100).toFixed(0) : 0;
                                        return `
                                            <div class="border-2 ${isBest ? 'border-green-500 bg-green-50' : 'border-gray-200'} rounded-lg p-4 ${isBest ? 'top-pick' : ''}">
                                                <div class="flex justify-between items-center mb-2">
                                                    <span class="font-bold">${pred.label}</span>
                                                    <span class="text-2xl font-bold ${pred.score > 50 ? 'confidence-high' : pred.score > 30 ? 'confidence-medium' : 'confidence-low'}">
                                                        ${pred.score}
                                                    </span>
                                                </div>
                                                <div class="w-full bg-gray-200 rounded-full h-2 mb-2">
                                                    <div class="bg-green-500 h-2 rounded-full" style="width: ${percentage}%"></div>
                                                </div>
                                                <div class="text-xs text-gray-600">
                                                    ${pred.factors.length > 0 ? pred.factors.join(' ‚Ä¢ ') : 'Nessun fattore rilevante disponibile'}
                                                </div>
                                                ${isBest ? '<div class="mt-2 text-green-600 font-bold text-sm">‚úì CONSIGLIATO DALL'ALGORITMO</div>' : ''}
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>

                            <!-- STATISTICS -->
                            ${statistics && statistics.length === 2 ? `
                                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                                    <h3 class="text-xl font-bold mb-4">üìà Statistiche Partita</h3>
                                    <div class="space-y-3">
                                        ${this.renderStatComparison(statistics, 'Ball Possession', '%')}
                                        ${this.renderStatComparison(statistics, 'Shots on Goal', '')}
                                        ${this.renderStatComparison(statistics, 'Total Shots', '')}
                                        ${this.renderStatComparison(statistics, 'Corner Kicks', '')}
                                        ${this.renderStatComparison(statistics, 'Yellow Cards', '')}
                                        ${this.renderStatComparison(statistics, 'Red Cards', '')}
                                        ${this.renderStatComparison(statistics, 'Fouls', '')}
                                    </div>
                                </div>
                            ` : '<div class="bg-white rounded-xl shadow-lg p-6 mb-6"><p class="text-gray-500">Statistiche non ancora disponibili (partita non iniziata)</p></div>'}

                            <!-- H2H -->
                            ${h2h && h2h.length > 0 ? `
                                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                                    <h3 class="text-xl font-bold mb-4">üîÑ Scontri Diretti (Ultimi 5)</h3>
                                    <div class="space-y-2">
                                        ${h2h.slice(0, 5).map(match => {
                                            const date = new Date(match.fixture.date).toLocaleDateString('it-IT');
                                            return `
                                                <div class="flex items-center justify-between border-b pb-2">
                                                    <span class="text-sm text-gray-500">${date}</span>
                                                    <span class="font-semibold">${match.teams.home.name} ${match.goals.home || 0} - ${match.goals.away || 0} ${match.teams.away.name}</span>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            ` : '<div class="bg-white rounded-xl shadow-lg p-6 mb-6"><p class="text-gray-500">Nessuno scontro diretto recente disponibile</p></div>'}

                            <!-- INJURIES -->
                            ${injuries && injuries.length > 0 ? `
                                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                                    <h3 class="text-xl font-bold mb-4">üöë Infortuni e Assenze</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <h4 class="font-semibold mb-2">${selectedMatch.teams.home.name}</h4>
                                            ${injuries.filter(i => i.team.id === selectedMatch.teams.home.id).map(inj => `
                                                <div class="text-sm text-gray-700 mb-1">‚ö†Ô∏è ${inj.player.name} - ${inj.player.reason || 'Infortunato'}</div>
                                            `).join('') || '<div class="text-sm text-gray-500">Nessun infortunato</div>'}
                                        </div>
                                        <div>
                                            <h4 class="font-semibold mb-2">${selectedMatch.teams.away.name}</h4>
                                            ${injuries.filter(i => i.team.id === selectedMatch.teams.away.id).map(inj => `
                                                <div class="text-sm text-gray-700 mb-1">‚ö†Ô∏è ${inj.player.name} - ${inj.player.reason || 'Infortunato'}</div>
                                            `).join('') || '<div class="text-sm text-gray-500">Nessun infortunato</div>'}
                                        </div>
                                    </div>
                                </div>
                            ` : '<div class="bg-white rounded-xl shadow-lg p-6 mb-6"><p class="text-gray-500">Nessun infortunio segnalato</p></div>'}

                            <!-- SAVE PREDICTION -->
                            <div class="bg-white rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-bold mb-4">üíæ Salva il Tuo Pronostico</h3>
                                <p class="text-gray-600 mb-4">Seleziona un pronostico per tracciare le tue statistiche:</p>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                    ${Object.keys(prediction.all).map(key => `
                                        <button class="save-pred-btn bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition" data-prediction="${key}">
                                            ${prediction.all[key].label}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderStatComparison(statistics, statName, unit) {
                const homeStats = statistics[0];
                const awayStats = statistics[1];

                const homeStat = homeStats.statistics.find(s => s.type === statName);
                const awayStat = awayStats.statistics.find(s => s.type === statName);

                if (!homeStat || !awayStat) return '';

                const homeValue = parseInt(homeStat.value) || 0;
                const awayValue = parseInt(awayStat.value) || 0;
                const total = homeValue + awayValue || 1;
                const homePerc = (homeValue / total * 100).toFixed(0);
                const awayPerc = (awayValue / total * 100).toFixed(0);

                return `
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span class="font-semibold">${homeStats.team.name}: ${homeValue}${unit}</span>
                            <span class="text-gray-600">${statName}</span>
                            <span class="font-semibold">${awayValue}${unit} :${awayStats.team.name}</span>
                        </div>
                        <div class="flex h-6 rounded-full overflow-hidden bg-gray-200">
                            <div class="bg-blue-500 flex items-center justify-center text-white text-xs font-bold" style="width: ${homePerc}%">${homePerc > 15 ? homePerc + '%' : ''}</div>
                            <div class="bg-red-500 flex items-center justify-center text-white text-xs font-bold" style="width: ${awayPerc}%">${awayPerc > 15 ? awayPerc + '%' : ''}</div>
                        </div>
                    </div>
                `;
            }

            attachEvents() {
                // Category filter
                const categoryFilter = document.getElementById('categoryFilter');
                if (categoryFilter) {
                    categoryFilter.addEventListener('change', (e) => {
                        this.setState({ filterCategory: e.target.value });
                    });
                }

                // League selector
                const leagueSelect = document.getElementById('leagueSelect');
                if (leagueSelect) {
                    leagueSelect.addEventListener('change', (e) => {
                        this.setState({ selectedLeague: parseInt(e.target.value) });
                    });
                }

                // Load button
                const loadBtn = document.getElementById('loadBtn');
                if (loadBtn) {
                    loadBtn.addEventListener('click', () => this.loadFixtures());
                }

                // Match cards
                document.querySelectorAll('.match-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const fixtureId = card.dataset.fixtureId;
                        const fixture = this.state.fixtures.find(f => f.fixture.id == fixtureId);
                        if (fixture) this.selectMatch(fixture);
                    });
                });

                // Back button
                const backBtn = document.getElementById('backBtn');
                if (backBtn) {
                    backBtn.addEventListener('click', () => {
                        this.setState({ view: 'fixtures', selectedMatch: null, matchDetails: null });
                    });
                }

                // Save prediction buttons
                document.querySelectorAll('.save-pred-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const prediction = btn.dataset.prediction;
                        this.savePrediction(this.state.selectedMatch.fixture.id, prediction);
                    });
                });
            }
        }

        // ============================================================
        // üöÄ APP INITIALIZATION
        // ============================================================
        const app = new App();
    </script>
</body>
</html>
